@*
    Modal Component
    Reusable modal dialog for various content types
    
    Usage:
    <Modal @ref="_modal" Title="My Modal" Size="Modal.ModalSize.Large">
        <HeaderIcon>
            <svg>...</svg>
        </HeaderIcon>
        <Body>
            <p>Modal content goes here</p>
        </Body>
        <Footer>
            <button class="btn btn-secondary" @onclick="CloseModal">Cancel</button>
            <button class="btn btn-primary" @onclick="DoSomething">Confirm</button>
        </Footer>
    </Modal>
    
    @code {
        private Modal? _modal;
        
        private void ShowModal() => _modal?.Show();
        private void CloseModal() => _modal?.Hide();
    }
*@

@if (_isVisible)
{
    <div class="modal-backdrop" @onclick="Hide"></div>
    <div class="modal-container">
        <div class="modal-dialog @SizeClass @AdditionalClass" @onclick:stopPropagation="true">
            <div class="modal-header @(HeaderIcon is not null || ShowCloseButton ? "modal-header-row" : "")">
                @if (HeaderIcon is not null)
                {
                    <div class="modal-header-content">
                        <span class="modal-header-icon">
                            @HeaderIcon
                        </span>
                        <h3 class="modal-title">@Title</h3>
                    </div>
                }
                else
                {
                    <h3 class="modal-title">@Title</h3>
                }
                @if (ShowCloseButton)
                {
                    <button class="modal-close" @onclick="Hide" type="button" aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </button>
                }
            </div>
            @if (Body is not null)
            {
                <div class="modal-body @(CenterBody ? "" : "modal-body-left")">
                    @Body
                </div>
            }
            @if (Footer is not null)
            {
                <div class="modal-footer">
                    @Footer
                </div>
            }
        </div>
    </div>
}

@code {
    private bool _isVisible;

    [Parameter] public string Title { get; set; } = "Modal";
    [Parameter] public RenderFragment? HeaderIcon { get; set; }
    [Parameter] public RenderFragment? Body { get; set; }
    [Parameter] public RenderFragment? Footer { get; set; }
    [Parameter] public ModalSize Size { get; set; } = ModalSize.Default;
    [Parameter] public bool ShowCloseButton { get; set; } = true;
    [Parameter] public bool CenterBody { get; set; } = false;
    [Parameter] public string? AdditionalClass { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private string SizeClass => Size switch
    {
        ModalSize.Small => "modal-dialog-sm",
        ModalSize.Large => "modal-dialog-lg",
        ModalSize.ExtraLarge => "modal-dialog-xl",
        ModalSize.FullWidth => "modal-dialog-full",
        _ => ""
    };

    public void Show()
    {
        _isVisible = true;
        StateHasChanged();
    }

    public void Hide()
    {
        _isVisible = false;
        OnClose.InvokeAsync();
        StateHasChanged();
    }

    public bool IsVisible => _isVisible;

    public enum ModalSize { Small, Default, Large, ExtraLarge, FullWidth }
}

